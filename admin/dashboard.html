<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Machpelah Electronics</title>
    <link rel="stylesheet" href="../css/admin.css">
    
    <!-- Supabase CDN - Using latest version for new API key support -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.46.1"></script>
</head>
<body>
    <div class="admin-header">
        <div class="header-content">
            <div class="logo-section">
                <img src="../images/icons/Logoicon.png" alt="Machpelah Electronics Logo" class="logo">
                <div class="brand-title">Machpelah Admin</div>
            </div>
            <a href="login.html" class="logout-btn">Logout</a>
        </div>
    </div>

    <div class="admin-container">
        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <img src="../images/icons/product_icon.png" alt="Products">
                </div>
                 <div class="stat-value" id="total-products">0</div>
                <div class="stat-label">Total Products</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <img src="../images/icons/instock_icon.png" alt="in-stock">
                </div>
                <div class="stat-value" id="in-stock">0</div>
                <div class="stat-label">In Stock</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <img src="../images/icons/stock alert icon.png" alt="in-stock">
                </div>
                <div class="stat-value" id="low-stock">0</div>
                <div class="stat-label">Low Stock</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" data-tab="announcements">
                    <img src="../images/icons/announcement icon.png" alt="Announcements" class="tab-icon">
                    Announcements
                </button>
                <button class="tab" data-tab="products">
                    <img src="../images/icons/product icon.png" alt="Products" class="tab-icon">
                    Products
                </button>
                <button class="tab" data-tab="add-product">
                    <img src="../images/icons/add product icon.png" alt="Add Product" class="tab-icon">
                    Add Product
                </button>
            </div>
        </div>

        <!-- Announcements Tab -->
        <div id="announcements" class="tab-content active">
            <div class="admin-section">
                <h2>Manage Announcements</h2>
                <div id="announcement-alert"></div>
                
                <div class="form-group">
                    <label for="announcement-text">Announcement Message</label>
                    <textarea id="announcement-text" placeholder="Enter announcement text (e.g., üéâ 20% OFF on all Smart Watches this week!)"></textarea>
                </div>

                <div class="form-group">
                    <label>Announcement Type</label>
                    <div style="display: flex; gap: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="announcement-type" value="positive" checked>
                            <img src="../images/icons/good news icon.png" alt="Good News" style="width: 20px; height: 20px; object-fit: contain;">
                            <span style="color: var(--success); font-weight: 600;">Positive (Green)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="announcement-type" value="negative">
                            <img src="../images/icons/bad news icon.png" alt="Bad News" style="width: 20px; height: 20px; object-fit: contain;">
                            <span style="color: var(--danger); font-weight: 600;">Negative (Red)</span>
                        </label>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" id="update-announcement-btn">
                        Update Announcement
                    </button>
                    <button class="btn btn-danger" id="clear-announcement-btn">
                        Clear Announcement
                    </button>
                </div>

                <div class="alert alert-info" style="margin-top: 1.5rem;">
                    <strong>Current Announcement:</strong><br>
                    <div id="current-announcement-preview" style="margin-top: 0.5rem;">None</div>
                </div>
            </div>
        </div>

        <!-- Products Tab -->
        <div id="products" class="tab-content">
            <div class="admin-section">
                <h2>Manage Products</h2>
                <div id="products-alert"></div>
                
                <div class="table-container">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price (MWK)</th>
                                <th>Stock</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-list">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Add Product Tab -->
        <div id="add-product" class="tab-content">
            <div class="admin-section">
                <h2>Add New Product</h2>
                <div id="add-product-alert"></div>
                
                <form id="add-product-form">
                    <div class="form-group">
                        <label for="product-name">Product Name *</label>
                        <input type="text" id="product-name" placeholder="e.g., Smart Watch X1" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-category">Category *</label>
                            <select id="product-category" required>
                                <option value="">Select Category</option>
                                <option value="PC">PC</option>
                                <option value="Smart Watch">Smart Watch</option>
                                <option value="Kettle">Kettle</option>
                                <option value="Hotplate">Hotplate</option>
                                <option value="Rice Cooker">Rice Cooker</option>
                                <option value="Others">Others</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="product-price">Price (MWK) *</label>
                            <input type="number" id="product-price" placeholder="50000" min="0" required>
                        </div>

                        <div class="form-group">
                            <label for="product-stock">Stock Quantity *</label>
                            <input type="number" id="product-stock" placeholder="10" min="0" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="product-image">Image URL *</label>
                        <input type="url" id="product-image" placeholder="https://example.com/image.jpg" required>
                    </div>

                    <div class="form-group">
                        <label for="product-description">Description</label>
                        <textarea id="product-description" placeholder="Enter product description"></textarea>
                    </div>

                    <button type="submit" class="btn btn-success">Add Product</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="admin-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Machpelah Electronics</h3>
                <p>Your trusted partner for quality electronics and home appliances in Malawi.</p>
                <div class="social-links">
                    <a href="#" title="Facebook">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                    </a>
                    <a href="#" title="Instagram">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                        </svg>
                    </a>
                    <a href="#" title="WhatsApp">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                        </svg>
                    </a>
                </div>
            </div>

            <div class="footer-section">
                <h3>Quick Links</h3>
                <a href="../index.html">Home</a>
                <a href="../pages/products.html">Products</a>
                <a href="../pages/about.html">About Us</a>
                <a href="../pages/contact.html">Contact</a>
            </div>

            <div class="footer-section">
                <h3>Admin Tools</h3>
                <a href="#announcements" data-tab-link="announcements">Announcements</a>
                <a href="#products" data-tab-link="products">Manage Products</a>
                <a href="#add-product" data-tab-link="add-product">Add Product</a>
            </div>

            <div class="footer-section">
                <h3>Contact Info</h3>
                <p>
                    <img src="../images/icons/location_icon.png" alt="Location" style="width: 16px; height: 16px; object-fit: contain; vertical-align: middle; margin-right: 0.5rem;">
                    Blantyre, Malawi
                </p>
                <p>
                    <img src="../images/icons/phone_icon.png" alt="Phone" style="width: 16px; height: 16px; object-fit: contain; vertical-align: middle; margin-right: 0.5rem;">
                    +265 XXX XXX XXX
                </p>
                <p>
                    <img src="../images/icons/email_icon.png" alt="Email" style="width: 16px; height: 16px; object-fit: contain; vertical-align: middle; margin-right: 0.5rem;">
                    admin@machpelah.mw
                </p>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2024 Machpelah Electronics. All rights reserved. | Admin Dashboard</p>
        </div>
    </footer>

    <!-- Supabase Database Configuration -->
    <script>
        // Wrap everything in DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin dashboard loaded');

            // Supabase Configuration
            const SUPABASE_URL = 'https://ycpaoqlcqziszlkbmtys.supabase.co';
            // Using new publishable key
            const SUPABASE_ANON_KEY = 'sb_publishable_pY3O8k5g8yki-zGXAMdlXQ_ugRNoL60';

            console.log('Supabase URL:', SUPABASE_URL);
            console.log('API Key (first 20 chars):', SUPABASE_ANON_KEY.substring(0, 20) + '...');

            // Initialize Supabase client
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            // Products Database Functions
            const ProductsDB = {
                async getAll() {
                    try {
                        console.log('Fetching all products...');
                        const { data, error } = await supabase
                            .from('products')
                            .select('*')
                            .order('id', { ascending: false });
                        
                        if (error) throw error;
                        console.log('Products fetched:', data?.length);
                        return data || [];
                    } catch (error) {
                        console.error('Error fetching products:', error);
                        return [];
                    }
                },

                async add(product) {
                    try {
                        console.log('Adding product:', product);
                        const { data, error } = await supabase
                            .from('products')
                            .insert([{
                                name: product.name,
                                category: product.category,
                                price: product.price,
                                stock: product.stock,
                                image: product.image,
                                description: product.description
                            }])
                            .select();
                        
                        if (error) throw error;
                        console.log('Product added:', data[0]);
                        return { success: true, data: data[0] };
                    } catch (error) {
                        console.error('Error adding product:', error);
                        return { success: false, error: error.message };
                    }
                },

                async update(id, updates) {
                    try {
                        console.log('Updating product:', id, updates);
                        const { data, error } = await supabase
                            .from('products')
                            .update(updates)
                            .eq('id', id)
                            .select();
                        
                        if (error) throw error;
                        console.log('Product updated:', data[0]);
                        return { success: true, data: data[0] };
                    } catch (error) {
                        console.error('Error updating product:', error);
                        return { success: false, error: error.message };
                    }
                },

                async delete(id) {
                    try {
                        console.log('Deleting product:', id);
                        const { error } = await supabase
                            .from('products')
                            .delete()
                            .eq('id', id);
                        
                        if (error) throw error;
                        console.log('Product deleted');
                        return { success: true };
                    } catch (error) {
                        console.error('Error deleting product:', error);
                        return { success: false, error: error.message };
                    }
                }
            };

            // Announcements Database Functions
            const AnnouncementsDB = {
                async get() {
                    try {
                        console.log('Fetching announcement...');
                        const { data, error } = await supabase
                            .from('announcements')
                            .select('*')
                            .order('created_at', { ascending: false })
                            .limit(1)
                            .single();
                        
                        if (error && error.code !== 'PGRST116') throw error;
                        console.log('Announcement fetched:', data);
                        return data || null;
                    } catch (error) {
                        console.error('Error fetching announcement:', error);
                        return null;
                    }
                },

                async set(text, type) {
                    try {
                        console.log('Setting announcement:', text, type);
                        const { data: existing } = await supabase
                            .from('announcements')
                            .select('id')
                            .limit(1)
                            .single();

                        if (existing) {
                            const { data, error } = await supabase
                                .from('announcements')
                                .update({
                                    text: text,
                                    type: type,
                                    updated_at: new Date().toISOString()
                                })
                                .eq('id', existing.id)
                                .select();
                            
                            if (error) throw error;
                            console.log('Announcement updated');
                            return { success: true, data: data[0] };
                        } else {
                            const { data, error } = await supabase
                                .from('announcements')
                                .insert([{
                                    text: text,
                                    type: type
                                }])
                                .select();
                            
                            if (error) throw error;
                            console.log('Announcement created');
                            return { success: true, data: data[0] };
                        }
                    } catch (error) {
                        console.error('Error setting announcement:', error);
                        return { success: false, error: error.message };
                    }
                },

                async clear() {
                    try {
                        console.log('Clearing announcement...');
                        const { error } = await supabase
                            .from('announcements')
                            .delete()
                            .neq('id', 0);
                        
                        if (error) throw error;
                        console.log('Announcement cleared');
                        return { success: true };
                    } catch (error) {
                        console.error('Error clearing announcement:', error);
                        return { success: false, error: error.message };
                    }
                }
            };

            // Load current announcement from Supabase
            async function loadCurrentAnnouncement() {
                console.log('Loading current announcement...');
                const announcement = await AnnouncementsDB.get();
                
                if (announcement) {
                    displayAnnouncementPreview(announcement.text, announcement.type);
                    document.getElementById('announcement-text').value = announcement.text;
                    document.querySelector(`input[name="announcement-type"][value="${announcement.type}"]`).checked = true;
                } else {
                    document.getElementById('current-announcement-preview').textContent = 'No announcement set';
                }
            }

            // Update announcement in Supabase
            async function updateAnnouncement() {
                console.log('Updating announcement...');
                const text = document.getElementById('announcement-text').value.trim();
                const type = document.querySelector('input[name="announcement-type"]:checked').value;
                
                if (!text) {
                    showAlert('announcement-alert', '‚ö†Ô∏è Please enter an announcement message', 'info');
                    return;
                }

                const result = await AnnouncementsDB.set(text, type);
                
                if (result.success) {
                    displayAnnouncementPreview(text, type);
                    showAlert('announcement-alert', '‚úÖ Announcement updated successfully!', 'success');
                } else {
                    showAlert('announcement-alert', '‚ùå Error: ' + result.error, 'info');
                }
            }

            // Clear announcement from Supabase
            async function clearAnnouncement() {
                console.log('Clearing announcement...');
                const result = await AnnouncementsDB.clear();
                
                if (result.success) {
                    document.getElementById('announcement-text').value = '';
                    document.getElementById('current-announcement-preview').textContent = 'No announcement set';
                    document.querySelector('input[name="announcement-type"][value="positive"]').checked = true;
                    showAlert('announcement-alert', '‚úÖ Announcement cleared!', 'success');
                } else {
                    showAlert('announcement-alert', '‚ùå Error: ' + result.error, 'info');
                }
            }

            function displayAnnouncementPreview(text, type) {
                const iconSrc = type === 'positive' ? '../images/icons/good news icon.png' : '../images/icons/bad news icon.png';
                const color = type === 'positive' ? '#10b981' : '#ef4444';
                const bgColor = type === 'positive' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)';
                
                document.getElementById('current-announcement-preview').innerHTML = `
                    <div style="
                        display: flex; 
                        align-items: center; 
                        gap: 0.75rem; 
                        padding: 1rem; 
                        background: ${bgColor}; 
                        border-left: 4px solid ${color}; 
                        border-radius: 6px;
                    ">
                        <span style="
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            width: 30px;
                            height: 30px;
                            border-radius: 50%;
                            background: ${color};
                            padding: 5px;
                        ">
                            <img src="${iconSrc}" alt="${type}" style="width: 20px; height: 20px; object-fit: contain; filter: brightness(0) invert(1);">
                        </span>
                        <span style="flex: 1; color: #1a1a1a;">${text}</span>
                    </div>
                `;
            }

            // Load products from Supabase
            async function loadProducts() {
                console.log('Loading products...');
                const products = await ProductsDB.getAll();
                const tbody = document.getElementById('products-list');
                
                if (products.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No products yet. Add your first product!</td></tr>';
                } else {
                    tbody.innerHTML = products.map(product => `
                        <tr>
                            <td><img src="${product.image}" class="product-image-small" alt="${product.name}"></td>
                            <td><strong>${product.name}</strong></td>
                            <td>${product.category}</td>
                            <td><strong>${product.price.toLocaleString()}</strong></td>
                            <td>${product.stock}</td>
                            <td class="action-buttons">
                                <button class="btn btn-warning" onclick="window.editProduct(${product.id})">Edit</button>
                                <button class="btn btn-danger" onclick="window.deleteProduct(${product.id})">Delete</button>
                            </td>
                        </tr>
                    `).join('');
                }

                updateStatistics(products);
            }

            function updateStatistics(products) {
                document.getElementById('total-products').textContent = products.length;
                document.getElementById('in-stock').textContent = 
                    products.filter(p => p.stock > 0).length;
                document.getElementById('low-stock').textContent = 
                    products.filter(p => p.stock > 0 && p.stock < 10).length;
            }

            // Add product to Supabase
            async function addProduct(event) {
                event.preventDefault();
                console.log('Adding new product...');

                const newProduct = {
                    name: document.getElementById('product-name').value,
                    category: document.getElementById('product-category').value,
                    price: parseInt(document.getElementById('product-price').value),
                    stock: parseInt(document.getElementById('product-stock').value),
                    image: document.getElementById('product-image').value,
                    description: document.getElementById('product-description').value
                };

                const result = await ProductsDB.add(newProduct);

                if (result.success) {
                    showAlert('add-product-alert', '‚úÖ Product added successfully!', 'success');
                    document.getElementById('add-product-form').reset();
                    await loadProducts();
                } else {
                    showAlert('add-product-alert', '‚ùå Error: ' + result.error, 'info');
                }
            }

            // Make functions globally accessible for inline onclick handlers
            window.editProduct = async function(id) {
                console.log('Edit product:', id);
                const products = await ProductsDB.getAll();
                const product = products.find(p => p.id === id);

                if (!product) return;

                const newPrice = prompt('Enter new price:', product.price);
                const newStock = prompt('Enter new stock:', product.stock);

                const updates = {};
                if (newPrice !== null && newPrice !== '') updates.price = parseInt(newPrice);
                if (newStock !== null && newStock !== '') updates.stock = parseInt(newStock);

                if (Object.keys(updates).length > 0) {
                    const result = await ProductsDB.update(id, updates);
                    
                    if (result.success) {
                        await loadProducts();
                        showAlert('products-alert', '‚úÖ Product updated successfully!', 'success');
                    } else {
                        showAlert('products-alert', '‚ùå Error: ' + result.error, 'info');
                    }
                }
            };

            // Delete product
            window.deleteProduct = async function(id) {
                console.log('Delete product:', id);
                if (!confirm('Are you sure you want to delete this product?')) return;

                const result = await ProductsDB.delete(id);
                
                if (result.success) {
                    await loadProducts();
                    showAlert('products-alert', '‚úÖ Product deleted successfully!', 'success');
                } else {
                    showAlert('products-alert', '‚ùå Error: ' + result.error, 'info');
                }
            };

            function showAlert(elementId, message, type) {
                const alertDiv = document.getElementById(elementId);
                alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
                setTimeout(() => {
                    alertDiv.innerHTML = '';
                }, 4000);
            }

            // Tab switching with event delegation
            const tabsContainer = document.querySelector('.tabs');
            tabsContainer.addEventListener('click', function(e) {
                const tabButton = e.target.closest('.tab');
                if (!tabButton) return;

                const tabName = tabButton.getAttribute('data-tab');
                console.log('Switching to tab:', tabName);

                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });

                // Show selected tab content
                document.getElementById(tabName).classList.add('active');
                tabButton.classList.add('active');
            });

            // Footer tab links
            document.querySelectorAll('[data-tab-link]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabName = this.getAttribute('data-tab-link');
                    console.log('Footer link clicked:', tabName);

                    // Hide all tab contents
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });

                    // Remove active class from all tabs
                    document.querySelectorAll('.tab').forEach(tab => {
                        tab.classList.remove('active');
                    });

                    // Show selected tab content
                    document.getElementById(tabName).classList.add('active');
                    
                    // Add active class to corresponding tab button
                    document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');

                    // Scroll to top
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });

            // Add event listeners for buttons
            document.getElementById('update-announcement-btn').addEventListener('click', updateAnnouncement);
            document.getElementById('clear-announcement-btn').addEventListener('click', clearAnnouncement);
            document.getElementById('add-product-form').addEventListener('submit', addProduct);

            // Initialize on page load
            console.log('Initializing dashboard...');
            loadCurrentAnnouncement();
            loadProducts();
        });
    </script>
</body>
</html>